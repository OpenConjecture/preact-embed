'use strict';Object.defineProperty(exports,'__esModule',{value:true});var preact=require('preact'),hooks=require('preact/hooks');/* preact-embed | MIT License */
function C(n){return n.replace(/-([a-z])/gi,(o,e)=>e.toUpperCase())}function w(){if(document.currentScript)return document.currentScript;let n=document.getElementsByTagName("script");return n[n.length-1]}function R(n,o){try{return JSON.parse(n)}catch{return console.warn("[preact-habitat] Failed to parse JSON props:",n),o}}function O(n){let o={},e=n.attributes;for(let r=0;r<e.length;r++){let s=e[r];if(s.name.startsWith("data-prop-")){let a=C(s.name.slice(10)),t=s.value;if(t==="true")t=true;else if(t==="false")t=false;else if(t==="null")t=null;else if(!isNaN(Number(t))&&t!=="")t=Number(t);else try{let d=JSON.parse(t);typeof d=="object"&&(t=d);}catch{}o[a]=t;}}return o}function N(n){let o=n.querySelectorAll('script[type="application/json"], script[type="text/props"]'),e={};return o.forEach(r=>{let s=r.innerHTML.trim();if(s){let a=R(s,{});e={...e,...a};}}),e}function h(n,o){let e=O(n),r=N(n);return {...o,...r,...e}}function k(n){let{selector:o,inline:e,clientSpecified:r}=n,s=[];if(e){let a=w();a?.parentElement&&s.push(a.parentElement);}else if(r){let t=w()?.getAttribute("data-mount-in");t&&document.querySelectorAll(t).forEach(u=>s.push(u));}else o&&document.querySelectorAll(o).forEach(t=>s.push(t));return s}var P=Symbol("preact-habitat");function j(n,o){n[P]=o;}function A(n){return n[P]}function W(n){delete n[P];}function x(n){let o=[],e={};function r(t,d){let u=A(t);u&&(console.warn("[preact-habitat] Element already has a mounted widget"),u.unmount());let l=h(t,{...e.defaultProps,...d});if(e.onBeforeMount){let i=e.onBeforeMount(t,l);i&&(l=i);}e.clean&&Array.from(t.childNodes).forEach(c=>{c.nodeType===Node.ELEMENT_NODE&&c.tagName==="SCRIPT"&&(c.getAttribute("type")==="application/json"||c.getAttribute("type")==="text/props")||c.parentNode?.removeChild(c);});let p=t;if(e.shadowRoot){let i=typeof e.shadowRoot=="object"?e.shadowRoot:{mode:"open"};p=t.attachShadow(i);}let g=preact.h(n,l),I=e.hydrate?preact.hydrate:preact.render,E=()=>{I(g,p);};if(e.lazy){let i=typeof e.lazy=="object"?e.lazy:{},c=new IntersectionObserver(H=>{H.forEach(M=>{M.isIntersecting&&(E(),c.disconnect());});},i);c.observe(t);}else E();let v=()=>{preact.render(null,p),W(t),e.onUnmount?.(t);let i=o.findIndex(c=>c.element===t);i>-1&&o.splice(i,1);},T=i=>{l={...l,...i},preact.render(preact.h(n,l),p);};j(t,{root:p,vnode:g,unmount:v});let y={element:t,props:l,unmount:v,update:T};return o.push(y),e.onMounted?.(t,l),y}function s(t={}){if(e=t,t.tagName)return L(t.tagName,n,t),o;let d=k(t),u=[];return d.forEach(l=>{let p=r(l);u.push(p);}),u}function a(){[...o].forEach(t=>t.unmount());}return {render:s,renderOne:r,unmountAll:a,instances:o}}function L(n,o,e={}){if(customElements.get(n)){console.warn(`[preact-habitat] Custom element "${n}" already registered`);return}class r extends HTMLElement{constructor(){super();this._props={};this._root=null;this._mounted=false;if(e.shadowRoot!==false){let t=typeof e.shadowRoot=="object"?e.shadowRoot:{mode:"open"};this._root=this.attachShadow(t);}}static get observedAttributes(){return []}connectedCallback(){this._props=h(this,e.defaultProps),this._render(),this._mounted=true;}disconnectedCallback(){if(this._mounted){let t=this._root||this;preact.render(null,t),this._mounted=false;}}attributeChangedCallback(){this._mounted&&(this._props=h(this,e.defaultProps),this._render());}_render(){let t=this._root||this;preact.render(preact.h(o,this._props),t);}setProps(t){this._props={...this._props,...t},this._mounted&&this._render();}getProps(){return {...this._props}}}customElements.define(n,r);}var b=class{constructor(){this.events=new Map;}on(o,e){return this.events.has(o)||this.events.set(o,new Set),this.events.get(o).add(e),()=>this.off(o,e)}off(o,e){this.events.get(o)?.delete(e);}emit(o,...e){this.events.get(o)?.forEach(r=>{try{r(...e);}catch(s){console.error(`[preact-habitat] Error in event handler for "${o}":`,s);}});}clear(){this.events.clear();}},S=new b;function $(n,o){let[e,r]=hooks.useState(o);hooks.useEffect(()=>S.on(n,t=>{r(t);}),[n]);let s=hooks.useCallback(a=>{S.emit(n,a);},[n]);return [e,s]}function J(n,o={}){let{render:e}=x(n);return e(o)}function K(n,o={}){let e=()=>J(n,o);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e();}var Y=x;Object.defineProperty(exports,"h",{enumerable:true,get:function(){return preact.h}});Object.defineProperty(exports,"hydrate",{enumerable:true,get:function(){return preact.hydrate}});Object.defineProperty(exports,"render",{enumerable:true,get:function(){return preact.render}});Object.defineProperty(exports,"useCallback",{enumerable:true,get:function(){return hooks.useCallback}});Object.defineProperty(exports,"useEffect",{enumerable:true,get:function(){return hooks.useEffect}});Object.defineProperty(exports,"useMemo",{enumerable:true,get:function(){return hooks.useMemo}});Object.defineProperty(exports,"useRef",{enumerable:true,get:function(){return hooks.useRef}});Object.defineProperty(exports,"useState",{enumerable:true,get:function(){return hooks.useState}});exports.autoMount=K;exports.default=Y;exports.eventBus=S;exports.habitat=x;exports.mount=J;exports.registerCustomElement=L;exports.useHabitatEvent=$;//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map